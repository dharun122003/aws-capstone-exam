ansible/playbook.yml
 
---

- name: Configure Web Servers

  hosts: web

  become: yes
 
  tasks:
 
    - name: Update packages

      yum:

        name: "*"

        state: latest
 
    - name: Install Apache, PHP, MySQL client

      yum:

        name:

          - httpd

          - php

          - php-mysqlnd

          - mysql

        state: present
 
    - name: Start and enable Apache

      service:

        name: httpd

        state: started

        enabled: yes
 
    - name: Copy index.php

      copy:

        src: files/index.php

        dest: /var/www/html/index.php

        owner: apache

        group: apache

        mode: 0644
 
    - name: Copy db_check.php

      copy:

        src: files/db_check.php

        dest: /var/www/html/db_check.php

        owner: apache

        group: apache

        mode: 0644

 
ansible/files/index.php
 
<?php

$ip = $_SERVER['SERVER_ADDR'];

echo "<h1>Welcome to Streamline - v1</h1>";

echo "<p>Server IP: $ip</p>";

?>

 
ansible/files/db_check.php
 
<?php

$host = "RDS_ENDPOINT_HERE";

$user = "admin";

$pass = "Admin12345!";

$db   = "streamlinedb";
 
$conn = new mysqli($host, $user, $pass, $db);
 
if ($conn->connect_error) {

    die("Database Connection Failed");

}
 
echo "Database Connected Successfully";

?>

 
